---
/**
 * Cookie Consent Component
 *
 * A GDPR-compliant cookie consent banner that:
 * - Shows on first visit
 * - Stores user's choice in localStorage
 * - Handles Accept/Decline actions
 * - Can be extended to control analytics/tracking scripts
 */
---

<div class="cookie-consent" id="cookie-consent">
  <div class="cookie-consent-content">
    <div class="cookie-consent-text">
      <p>
        <strong>üç™ We use cookies</strong>
      </p>
      <p>
        This site uses cookies to enhance your browsing experience and remember your theme preferences.
        We do not use tracking or analytics cookies.
        <a href="/privacy" class="cookie-policy-link">Learn more</a>
      </p>
    </div>
    <div class="cookie-consent-actions">
      <button class="cookie-btn cookie-accept" id="cookie-accept">
        Accept
      </button>
      <button class="cookie-btn cookie-decline" id="cookie-decline">
        Decline
      </button>
    </div>
  </div>
</div>

<script>
  // Cookie consent functionality
  const COOKIE_CONSENT_KEY = 'themeforseen-cookie-consent';
  const cookieConsent = document.getElementById('cookie-consent');
  const acceptBtn = document.getElementById('cookie-accept');
  const declineBtn = document.getElementById('cookie-decline');

  // Check if user has already made a choice
  function checkCookieConsent() {
    const consent = localStorage.getItem(COOKIE_CONSENT_KEY);

    if (consent === null) {
      // No choice made yet, show the banner
      setTimeout(() => {
        cookieConsent?.classList.add('visible');
      }, 1000); // Delay to not be intrusive
    } else {
      // User has made a choice
      applyCookieConsent(consent === 'accepted');
    }
  }

  // Apply cookie consent settings
  function applyCookieConsent(accepted: boolean) {
    if (accepted) {
      console.log('Cookie consent: Accepted - Essential cookies enabled');
      // Enable analytics/tracking here if needed
      // Example: loadGoogleAnalytics();
    } else {
      console.log('Cookie consent: Declined - Only essential cookies');
      // Disable analytics/tracking
      // Only essential cookies (like theme preferences) will work
    }
  }

  // Handle accept
  acceptBtn?.addEventListener('click', () => {
    localStorage.setItem(COOKIE_CONSENT_KEY, 'accepted');
    applyCookieConsent(true);
    hideBanner();
  });

  // Handle decline
  declineBtn?.addEventListener('click', () => {
    localStorage.setItem(COOKIE_CONSENT_KEY, 'declined');
    applyCookieConsent(false);
    hideBanner();
  });

  // Hide the banner with animation
  function hideBanner() {
    cookieConsent?.classList.add('hiding');
    setTimeout(() => {
      cookieConsent?.classList.remove('visible', 'hiding');
    }, 300);
  }

  // Initialize on page load
  checkCookieConsent();
</script>

<style>
  .cookie-consent {
    position: fixed;
    bottom: -200px;
    left: 0;
    right: 0;
    z-index: 99999;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.98);
    border-top: 2px solid #e0e0e0;
    box-shadow: 0 -4px 24px rgba(0, 0, 0, 0.15);
    backdrop-filter: blur(10px);
    transition: bottom 0.3s ease-out;
  }

  @media (prefers-color-scheme: dark) {
    .cookie-consent {
      background: rgba(26, 26, 26, 0.98);
      border-top: 2px solid #444;
    }
  }

  .cookie-consent.visible {
    bottom: 0;
  }

  .cookie-consent.hiding {
    bottom: -200px;
  }

  .cookie-consent-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
    flex-wrap: wrap;
  }

  @media (max-width: 768px) {
    .cookie-consent-content {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
  }

  .cookie-consent-text {
    flex: 1;
  }

  .cookie-consent-text p {
    margin: 0;
    color: #333;
    font-size: 0.9rem;
    line-height: 1.5;
  }

  .cookie-consent-text p:first-child {
    margin-bottom: 0.5rem;
  }

  .cookie-consent-text strong {
    font-size: 1rem;
    color: #000;
  }

  @media (prefers-color-scheme: dark) {
    .cookie-consent-text p {
      color: #e0e0e0;
    }

    .cookie-consent-text strong {
      color: #fff;
    }
  }

  .cookie-policy-link {
    color: var(--color-primary);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .cookie-policy-link:hover {
    text-decoration: none;
  }

  .cookie-consent-actions {
    display: flex;
    gap: 0.75rem;
    flex-shrink: 0;
  }

  .cookie-btn {
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    font-family: inherit;
  }

  .cookie-accept {
    background: var(--color-primary);
    color: white;
  }

  .cookie-accept:hover {
    background: var(--color-primary-shadow);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .cookie-decline {
    background: #f0f0f0;
    color: #333;
    border: 1px solid #ccc;
  }

  .cookie-decline:hover {
    background: #e0e0e0;
  }

  @media (prefers-color-scheme: dark) {
    .cookie-decline {
      background: #3a3a3a;
      color: #e0e0e0;
      border: 1px solid #555;
    }

    .cookie-decline:hover {
      background: #444;
    }
  }

  /* Animation */
  @keyframes slideUp {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .cookie-consent.visible {
    animation: slideUp 0.3s ease-out;
  }
</style>
